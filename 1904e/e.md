[ ]{.csrf-token style="display:none;"
csrf="a1b6b71ec72e7952ef8bdda381cdab6e"}

::: {.notificationTextCleaner style="font-size: 0"}
:::

::: {.button-up style="display: none; opacity: 0.7; width: 50px; height:100%; position: fixed; left: 0; top: 0; cursor: pointer; text-align: center; line-height: 35px; color: #d3dbe4; font-weight: bold; font-size: 3.0rem;"}
:::

::: {.verdictPrototypeDiv style="display: none;"}
:::

::: {#body}
::: {.side-bell style="visibility: hidden; display: none; opacity: 0.7; width: 40px; position: fixed; right: 0; top: 0; cursor: pointer; text-align: center; line-height: 35px; color: #d3dbe4; font-weight: bold; font-size: 1.5rem;"}
[ ]{.icon-stack style="width: 100%;"}\
[]{.side-bell__count style="position: relative; top: -10px;"}
:::

::: {#header style="position: relative;"}
::: {style="float:left; max-height: 60px;"}
[![Codeforces](//codeforces.org/s/80867/images/codeforces-sponsored-by-ton.png "Codeforces"){height="65"}](/)
:::

::: {.lang-chooser}
::: {style="text-align: right;"}
[![In
English](//codeforces.org/s/80867/images/flags/24/gb.png "In English")](?locale=en)
[![По-русски](//codeforces.org/s/80867/images/flags/24/ru.png "По-русски")](?locale=ru)
:::

<div>

[Enter](/enter?back=%2Fcontest%2F1904%2Fproblem%2FE) \|
[Register](/register)

</div>
:::

\
:::

::: {.roundbox .menu-box .borderTopRound .borderBottomRound style=""}
::: {.menu-list-container}
-   [Home](/)
-   [Top](/top)
-   [Catalog](/catalog)
-   [Contests](/contests)
-   [Gym](/gyms)
-   [Problemset](/problemset)
-   [Groups](/groups)
-   [Rating](/ratings)
-   [[Edu]{.edu-menu-item}](/edu/courses)
-   [API](/apiHelp)
-   [Calendar](/calendar)
-   [Help](/help)

\
:::
:::

\

::: {style="position: relative;"}
::: {#sidebar}
::: {.roundbox .sidebox .borderTopRound style=""}
  [Codeforces Round 914 (Div. 2)](/contest/1904)
  ------------------------------------------------
  [Finished]{.contest-state-phase}
:::

::: {.roundbox .sidebox .borderTopRound style=""}
::: {.caption .titled}
→ Practice?

::: {.top-links}
:::
:::

<div>

::: {style="margin:1em;font-size:0.8em;"}
Want to solve the contest problems after the official contest ends? Just
register for practice and you will be able to submit solutions.
:::

::: {style="text-align:center;margin:1em;"}
:::

</div>
:::

::: {.roundbox .sidebox .ContestVirtualFrame .borderTopRound style=""}
::: {.caption .titled}
→ Virtual participation

::: {.top-links}
:::
:::

::: {style=" " page-url="/data/sidebarFrames"}
::: {style="margin:1em;font-size:0.8em;"}
Virtual contest is a way to take part in past contest, as close as
possible to participation on time. It is supported only ICPC mode for
virtual contests. If you\'ve seen these problems, a virtual contest is
not for you - solve these problems in the archive. If you just want to
solve some problem from a contest, a virtual contest is not for you -
solve this problem in the archive. Never use someone else\'s code, read
the tutorials or communicate with other person during a virtual contest.
:::

::: {style="text-align:center;margin:1em;"}
:::
:::
:::

::: {.roundbox .sidebox .borderTopRound style=""}
::: {.caption .titled}
→ Problem tags

::: {.top-links}
:::
:::

::: {style="padding: 0.5em;"}
::: {.roundbox .borderTopRound .borderBottomRound style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;"}
[ data structures ]{.tag-box style="font-size:1.2rem;"
title="Heaps, binary search trees, segment trees, hash tables, etc"}
:::

::: {.roundbox .borderTopRound .borderBottomRound style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;"}
[ dfs and similar ]{.tag-box style="font-size:1.2rem;"
title="Dfs and similar"}
:::

::: {.roundbox .borderTopRound .borderBottomRound style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;"}
[ graphs ]{.tag-box style="font-size:1.2rem;" title="Graphs"}
:::

::: {.roundbox .borderTopRound .borderBottomRound style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;"}
[ implementation ]{.tag-box style="font-size:1.2rem;"
title="Implementation problems, programming technics, simulation"}
:::

::: {.roundbox .borderTopRound .borderBottomRound style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;"}
[ trees ]{.tag-box style="font-size:1.2rem;" title="Trees"}
:::

::: {.roundbox .borderTopRound .borderBottomRound style="margin:2px; padding:0 3px 2px 3px; background-color:#f0f0f0;float:left;"}
[ \*2500 ]{.tag-box style="font-size:1.2rem;" title="Difficulty"}
:::

::: {style="clear:both;text-align:right;font-size:1.1rem;"}
[No tag edit access]{.notice title="Please login into the Codeforces"}
:::
:::
:::

::: {.roundbox .sidebox .sidebar-menu .borderTopRound style=""}
::: {.caption .titled}
→ Contest materials

::: {.top-links}
:::
:::

-    [Announcement
    [(en)]{.resource-locale}](/blog/entry/123079 "Codeforces Round 914 (Div. 2)")
    [
    ![](//codeforces.org/s/80867/images/icons/close-10x10.png){.delete-resource-link}
    ]{style="float: right;"}
    ::: {style="clear: both;"}
    :::
-    [Tutorial
    [(en)]{.resource-locale}](/blog/entry/123160 "Codeforces Round 914 (Div. 2) Editorial")
    [
    ![](//codeforces.org/s/80867/images/icons/close-10x10.png){.delete-resource-link}
    ]{style="float: right;"}
    ::: {style="clear: both;"}
    :::
:::
:::

::: {#pageContent .content-with-sidebar}
::: {.second-level-menu}
-   [Problems](/contest/1904)
-   [Submit Code](/contest/1904/submit)
-   [My Submissions](/contest/1904/my)
-   [Status](/contest/1904/status)
-   [Hacks](/contest/1904/hacks)
-   [Room](/contest/1904/room/1)
-   [Standings](/contest/1904/standings)
-   [Custom Invocation](/contest/1904/customtest)
:::

::: {.diff-popup}
:::

::: {.problemindexholder problemindex="E" uuid="ps_d4635372038231eb0ec047285e0e1955435918df"}
::: {.alert .alert-info .diff-notifier style="display: none; margin:1em 0;text-align: center; position: relative;"}
<div>

The problem statement has recently been changed. [View the
changes.](#){.view-changes}

</div>

[×]{.diff-notifier-close
style="position: absolute; top: 0.2em; right: 0.3em; cursor: pointer; font-size: 1.4em;"}
:::

::: {.ttypography}
::: {.problem-statement}
::: {.header}
::: {.title}
E. Tree Queries
:::

::: {.time-limit}
::: {.property-title}
time limit per test
:::

4 seconds
:::

::: {.memory-limit}
::: {.property-title}
memory limit per test
:::

512 megabytes
:::

::: {.input-file}
::: {.property-title}
input
:::

standard input
:::

::: {.output-file}
::: {.property-title}
output
:::

standard output
:::
:::

<div>

::: {.epigraph}
::: {.epigraph-text}
[Those who don\'t work don\'t eat. Get the things you want with your own
power. But believe, the earnest and serious people are the ones who have
the last laugh\... But even then, I won\'t give you a
present.]{.tex-font-style-it}
:::

::: {.epigraph-source}
---Santa, [Hayate no Gotoku!]{.tex-font-style-it}
:::
:::

[Since Hayate didn\'t get any Christmas presents from Santa, he is
instead left solving a tree query problem.]{.tex-font-style-it}

Hayate has a tree with \$\$\$n\$\$\$ nodes.

Hayate now wants you to answer \$\$\$q\$\$\$ queries. Each query
consists of a node \$\$\$x\$\$\$ and \$\$\$k\$\$\$ other additional
nodes \$\$\$a\_1,a\_2,\\ldots,a\_k\$\$\$. These \$\$\$k+1\$\$\$ nodes
are guaranteed to be all distinct.

For each query, you must find the length of the longest simple path
starting at node \$\$\$x\^\\dagger\$\$\$ after removing nodes
\$\$\$a\_1,a\_2,\\ldots,a\_k\$\$\$ along with all edges connected to at
least one of nodes \$\$\$a\_1,a\_2,\\ldots,a\_k\$\$\$.

\$\$\$\^\\dagger\$\$\$ A simple path of length \$\$\$k\$\$\$ starting at
node \$\$\$x\$\$\$ is a sequence of [distinct]{.tex-font-style-bf} nodes
\$\$\$x=u\_0,u\_1,\\ldots,u\_k\$\$\$ such that there exists a edge
between nodes \$\$\$u\_{i-1}\$\$\$ and \$\$\$u\_i\$\$\$ for all \$\$\$1
\\leq i \\leq k\$\$\$.

</div>

::: {.input-specification}
::: {.section-title}
Input
:::

The first line contains two integers \$\$\$n\$\$\$ and \$\$\$q\$\$\$
(\$\$\$1 \\le n, q \\le 2 \\cdot 10\^5\$\$\$) --- the number of nodes of
the tree and the number of queries.

The following \$\$\$n - 1\$\$\$ lines contain two integers \$\$\$u\$\$\$
and \$\$\$v\$\$\$ (\$\$\$1 \\le u, v \\le n\$\$\$, \$\$\$u \\ne
v\$\$\$) --- denoting an edge between nodes \$\$\$u\$\$\$ and
\$\$\$v\$\$\$. It is guaranteed that the given edges form a tree.

The following \$\$\$q\$\$\$ lines describe the queries. Each line
contains the integers \$\$\$x\$\$\$, \$\$\$k\$\$\$ and
\$\$\$a\_1,a\_2,\\ldots,a\_k\$\$\$ (\$\$\$1 \\leq x \\leq n\$\$\$,
\$\$\$0 \\leq k \< n\$\$\$, \$\$\$1 \\leq a\_i \\leq n\$\$\$) --- the
starting node, the number of removed nodes and the removed nodes.

It is guaranteed that for each query,
\$\$\$x,a\_1,a\_2,\\ldots,a\_k\$\$\$ are all distinct.

It is guaranteed that the sum of \$\$\$k\$\$\$ over all queries will not
exceed \$\$\$2 \\cdot 10\^5\$\$\$.
:::

::: {.output-specification}
::: {.section-title}
Output
:::

For each query, output a single integer denoting the answer for that
query.
:::

::: {.sample-tests}
::: {.section-title}
Examples
:::

::: {.sample-test}
::: {.input}
::: {.title}
Input
:::

    7 7
    1 2
    1 3
    3 4
    2 5
    2 6
    6 7
    2 0
    2 1 1
    2 2 1 6
    3 1 4
    3 1 1
    5 0
    5 2 1 6
:::

::: {.output}
::: {.title}
Output
:::
:::

::: {.input}
::: {.title}
Input
:::

    4 4
    1 2
    1 3
    2 4
    2 1 3
    3 1 4
    2 1 4
    2 3 1 3 4
:::

::: {.output}
::: {.title}
Output
:::
:::
:::
:::

::: {.note}
::: {.section-title}
Note
:::

In the first example, the tree is as follows:

![](https://espresso.codeforces.com/27256f5c8a44e6e192674facf1606ee765049f39.png){.tex-graphics}

In the first query, no nodes are missing. The longest simple path
starting from node \$\$\$2\$\$\$ is \$\$\$2 \\to 1 \\to 3 \\to 4\$\$\$.
Thus, the answer is \$\$\$3\$\$\$.

In the third query, nodes \$\$\$1\$\$\$ and \$\$\$6\$\$\$ are missing
and the tree is shown below. The longest simple path starting from node
\$\$\$2\$\$\$ is \$\$\$2 \\to 5\$\$\$. Thus, the answer is
\$\$\$1\$\$\$.

![](https://espresso.codeforces.com/aa3b49b521332722e94e8ad3f0b0b60934b52a84.png){.tex-graphics}
:::
:::
:::
:::
:::
:::

\

::: {#footer}
<div>

[Codeforces](https://codeforces.com/) (c) Copyright 2010-2024 Mike
Mirzayanov

</div>

<div>

The only programming contests Web 2.0 platform

</div>

<div>

Server time: [May/06/2024 19:57:20]{.format-timewithseconds locale="en"}
(k3).

</div>

<div>

Desktop version, switch to [mobile
version](?mobile=true){.switchToMobile}.

</div>

::: {.smaller}
[Privacy Policy](/privacy)
:::

::: {style="margin-top: 25px;"}
Supported by
:::

::: {style="margin-top: 8px; padding-bottom: 20px; position: relative; left: 10px;"}
[![TON](//codeforces.org/s/80867/images/ton-100x100.png "TON")](https://ton.org/)
[![ИТМО](//codeforces.org/s/80867/images/itmo_small_en-logo.png "ИТМО")](http://ifmo.ru/en/)
:::
:::

::: {.userListsFacebox style="display:none;"}
::: {style="padding: 0.5em; width: 600px; max-height: 200px; overflow-y: auto"}
::: {.datatable style="background-color: #E1E1E1; padding-bottom: 3px;"}
::: {.lt}
 
:::

::: {.rt}
 
:::

::: {.lb}
 
:::

::: {.rb}
 
:::

::: {style="padding: 4px 0 0 6px;font-size:1.4rem;position:relative;"}
User lists

::: {style="position:absolute;right:0.25em;top:0.35em;"}
[]{.rowCount style="padding:0;position:relative;bottom:2px;"}
![](//codeforces.org/s/80867/images/icons/control.png){.closed} [
![](//codeforces.org/s/80867/images/icons/control-270.png){.opened}
]{.filter style="display:none;"}
:::
:::

::: {style="background-color: white;margin:0.3em 3px 0 3px;position:relative;"}
::: {.ilt}
 
:::

::: {.irt}
 
:::

  Name
  ------
:::
:::
:::
:::
:::
